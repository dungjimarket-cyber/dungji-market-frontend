# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview
Dungji Market (ë‘¥ì§€ë§ˆì¼“) is a Next.js-based group purchasing platform for telecommunications and internet services in Korea. Users can create and participate in group purchases to get better deals on mobile plans, internet services, and electronics.

**PWA Ready**: The application is now configured as a Progressive Web App (PWA) and ready for deployment to iOS App Store and Google Play Store.

## Development Commands

### Core Commands
```bash
npm run dev           # Start development server (http://localhost:3000)
npm run build         # Build for production
npm run start         # Start production server
npm run lint          # Run ESLint
npm run test          # Run Jest tests
npm run test:watch    # Run tests in watch mode
npm run test:coverage # Run tests with coverage report
```

### Testing Commands
```bash
npm test -- src/__tests__/issue-verification.test.tsx  # Run specific test file
npm test -- --updateSnapshot                           # Update test snapshots
npm test -- --watchAll                                 # Run all tests in watch mode
npm test -- --coverage                                 # Generate coverage report
npm test -- src/components/                            # Test all files in directory
```

## Architecture Overview

### Tech Stack
- **Framework**: Next.js 15.1.6 with App Router
- **UI**: React 19, Tailwind CSS, Radix UI components
- **State Management**: Zustand for global state, React Hook Form for forms
- **Authentication**: NextAuth.js with JWT tokens, supports Kakao/Google OAuth
- **Backend Integration**: Axios for API calls, WebSocket for real-time features
- **Testing**: Jest with React Testing Library
- **Deployment**: Vercel with serverless functions
- **PWA**: next-pwa with Service Worker and offline caching

### Key Directories
- `src/app/` - Next.js App Router pages and API routes
  - `src/app/api/` - Backend API routes (auth, groupbuys, payment, etc.)
  - `src/app/(partner)/` - Partner-specific routes with shared layout
- `src/components/` - Reusable React components organized by feature
  - `src/components/ui/` - Base UI components (shadcn/ui components)
  - `src/components/auth/` - Authentication-related components
  - `src/components/groupbuy/` - Group buying functionality components
- `src/contexts/` - React Context providers (AuthContext, PartnerContext)
- `src/lib/` - Utility functions and service layers
  - `src/lib/api/` - API service functions organized by feature
- `src/stores/` - Zustand stores for state management
- `src/types/` - TypeScript type definitions
- `src/hooks/` - Custom React hooks
- `src/middleware/` - Next.js middleware for authentication
- `public/` - Static assets including PWA icons and manifest

### PWA Configuration
- **Manifest**: `/public/manifest.json` - App metadata and icons
- **Service Worker**: Auto-generated by next-pwa
- **Icons**: Multiple sizes (72x72 to 512x512) in `/public/icons/`
- **Caching Strategy**: Network-first with 30-day expiration
- **Install Prompt**: Available on supported devices

### Authentication Flow
The app uses a dual authentication system:
1. **NextAuth.js** for OAuth providers (Kakao, Google)
2. **Custom JWT** implementation for email/password authentication
3. Auth tokens are stored in localStorage and managed via AuthContext
4. Role-based access control for buyers (ì¼ë°˜íšŒì›) and sellers (íŒë§¤ì)

### API Integration Pattern
- Base API URL: Set via `NEXT_PUBLIC_API_URL` environment variable
- Auth headers automatically attached via axios interceptors
- Token refresh handled automatically on 401 responses
- API services organized in `src/lib/api/` by feature

### Key Features & Routes

#### User Types
- **ì¼ë°˜íšŒì› (Buyers)**: Can create/join group purchases
- **íŒë§¤ì (Sellers)**: Can bid on group purchases, requires business verification

#### Main Pages
- `/` - Homepage with active group purchases
- `/group-purchases/create` - Create new group purchase
- `/groupbuys/[id]` - Group purchase detail page
- `/mypage` - User dashboard (different views for buyers/sellers)
- `/seller-dashboard` - Seller management interface
- `/bid-tickets` - Bid token purchase page

### Component Patterns
- Use existing UI components from `src/components/ui/`
- Follow shadcn/ui patterns for new components
- Client components marked with `'use client'` directive
- Server components by default in App Router

### Form Handling
- Use React Hook Form with Zod validation
- Form schemas defined alongside components
- Validation errors displayed via form.formState.errors

### Real-time Features
- Bid updates via WebSocket connections
- Timer synchronization for auction deadlines
- Notification system for bid status changes

## Environment Variables Required
```
NEXT_PUBLIC_API_URL              # Backend API URL
NEXT_PUBLIC_APP_URL              # Frontend URL
NEXTAUTH_URL                     # NextAuth base URL
NEXTAUTH_SECRET                  # NextAuth encryption secret
JWT_SECRET                       # JWT signing secret
KAKAO_CLIENT_ID                  # Kakao OAuth credentials
KAKAO_CLIENT_SECRET
GOOGLE_CLIENT_ID                 # Google OAuth credentials
GOOGLE_CLIENT_SECRET
```

## Common Development Tasks

### Adding a New Page
1. Create route in `src/app/[route]/page.tsx`
2. Add navigation link in DesktopNavbar/MobileNavbar if needed
3. Implement authentication check if required

### Creating API Routes
1. Add route handler in `src/app/api/[route]/route.ts`
2. Use NextResponse for responses
3. Handle auth verification via JWT tokens

### Working with Group Purchases
- Main types defined in `src/types/groupbuy.ts`
- State management via `src/stores/useGroupPurchase.ts`
- API services in `src/lib/api/`

### Styling Guidelines
- Use Tailwind CSS utility classes
- Follow existing component patterns
- Responsive design with mobile-first approach
- Dark mode not currently implemented

### PWA Development
- PWA disabled in development mode (next-pwa config)
- Test PWA features in production build: `npm run build && npm run start`
- Service worker updates on app reload
- Offline functionality for cached resources

## Development Workflow

**IMPORTANT: After implementing any feature or fix, ALWAYS follow this workflow:**

1. **Build the project** to check for compilation errors:
   ```bash
   npm run build
   ```

2. **Test the changes** locally if applicable:
   ```bash
   npm run dev
   # Test the feature in the browser
   ```

3. **Commit and push** the changes:
   ```bash
   git add -A
   git commit -m "type: description of changes
   
   - Detail 1
   - Detail 2
   
   ğŸ¤– Generated with [Claude Code](https://claude.ai/code)
   
   Co-Authored-By: Claude <noreply@anthropic.com>"
   git push origin main
   ```

**This workflow ensures:**
- Code compiles without errors before deployment
- Changes are tested locally
- All changes are properly versioned and deployed
- Vercel automatically deploys on push to main

## Testing Approach
- **Test Framework**: Jest with React Testing Library
- **Test Location**: Test files in `src/__tests__/` or alongside components
- **Path Aliases**: `@/` maps to `src/` directory
- **Coverage**: Excludes `*.d.ts`, `layout.tsx`, and `globals.css`
- **Transforms**: Configured to handle `lucide-react` imports
- Unit tests for utilities and hooks
- Integration tests for critical user flows
- Mock API responses for testing

## Deployment Notes
- Deployed on Vercel with automatic deployments on push to main branch
- Serverless functions for API routes with 60s timeout
- Cron jobs configured for status updates (`/api/cron/`)
- Image optimization disabled due to Vercel free tier limits
- Node.js version: >=18.0.0 (check `.nvmrc` for specific version)
- PWA files (service worker, manifest) auto-generated during build

## PWA Deployment
- **Ready for App Stores**: See `PWA_DEPLOYMENT_GUIDE.md` for complete deployment instructions
- **Recommended Tools**: PWABuilder.com for packaging iOS/Android apps
- **App Store Requirements**: All assets and metadata configured
- **Testing**: Use Chrome DevTools > Application > Manifest to test PWA features

## Linting and Code Quality
- **ESLint**: Uses flat config format with TypeScript parser
- **Unused Imports**: Plugin configured but disabled for flexibility
- **Next.js Rules**: Enforced for proper HTML link usage
- Lint command: `npm run lint`

## ì¤‘ê³ í° ì§ê±°ë˜ ê¸°ëŠ¥ (Used Phone Trading)

### ê°œë°œ ë¬¸ì„œ
- **PRD**: `PRD_ì¤‘ê³ í°ì§ê±°ë˜.md` - ì œí’ˆ ìš”êµ¬ì‚¬í•­ ë° ë¹„ì¦ˆë‹ˆìŠ¤ ëª©í‘œ
- **ê¸°ëŠ¥ ëª…ì„¸ì„œ**: `ê¸°ëŠ¥ê°œë°œëª…ì„¸ì„œ_ì¤‘ê³ í°ì§ê±°ë˜.md` - ìƒì„¸ ê¸°ìˆ  êµ¬í˜„ ì‚¬ì–‘
- **ì‘ì—… ê´€ë¦¬**: `ì‘ì—…ê´€ë¦¬ë¬¸ì„œ_ì¤‘ê³ í°ì§ê±°ë˜.md` - ì§„í–‰ ìƒí™© ë° ì´ìŠˆ íŠ¸ë˜í‚¹

### ì£¼ìš” ê¸°ëŠ¥
- **ìƒí’ˆ ê´€ë¦¬**: ìµœëŒ€ 5ê°œ ë™ì‹œ ë“±ë¡, ë‹¤ì¤‘ ì´ë¯¸ì§€ ì—…ë¡œë“œ
- **ê±°ë˜ ì‹œìŠ¤í…œ**: ê°€ê²© ì œì•ˆ, ì¦‰ì‹œêµ¬ë§¤, ê±°ë˜ ìƒíƒœ ê´€ë¦¬
- **í”„ë¡œí•„ ì²´í¬**: ì¤‘ê³ í° ê±°ë˜ìš© í•„ìˆ˜ ì •ë³´ í™•ì¸ (ì—°ë½ì²˜, í™œë™ì§€ì—­)
- **ê²€ìƒ‰/í•„í„°**: ë¸Œëœë“œ, ê°€ê²©, ìš©ëŸ‰, ìƒíƒœë³„ í•„í„°ë§

### í•µì‹¬ ì»´í¬ë„ŒíŠ¸
```
src/components/used/
â”œâ”€â”€ UsedPhoneCard.tsx         # ìƒí’ˆ ì¹´ë“œ
â”œâ”€â”€ UsedPhoneFilter.tsx        # í•„í„° UI  
â”œâ”€â”€ UsedPhoneGallery.tsx       # ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬
â”œâ”€â”€ PriceOfferModal.tsx        # ê°€ê²© ì œì•ˆ ëª¨ë‹¬
â”œâ”€â”€ RegistrationLimitModal.tsx # ë“±ë¡ ì œí•œ ì•ˆë‚´
â””â”€â”€ UsedPhoneForm.tsx          # ë“±ë¡/ìˆ˜ì • í¼
```

### API ì—”ë“œí¬ì¸íŠ¸
- `GET/POST /api/used/phones/` - ìƒí’ˆ ëª©ë¡/ë“±ë¡
- `GET/PUT/DELETE /api/used/phones/{id}/` - ìƒí’ˆ ìƒì„¸/ìˆ˜ì •/ì‚­ì œ
- `POST /api/used/phones/{id}/offer/` - ê°€ê²© ì œì•ˆ
- `GET /api/used/phones/{id}/my-offer/` - ë‚´ ì œì•ˆ ì¡°íšŒ
- `POST /api/used/phones/{id}/favorite/` - ì°œí•˜ê¸°
- `GET /api/used/phones/check-limit/` - ë“±ë¡ ì œí•œ ì²´í¬

### Custom Hooks
- `useUsedPhoneProfileCheck()` - ì¤‘ê³ í° ê±°ë˜ í”„ë¡œí•„ ì²´í¬
- `useImageUpload()` - ë‹¤ì¤‘ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
- `usePriceOffer()` - ê°€ê²© ì œì•ˆ ê´€ë¦¬

### ê°œë°œ í˜„í™©
- **ì§„í–‰ë¥ **: 75% (Phase 1 ì™„ë£Œ, Phase 2 ì§„í–‰ì¤‘)
- **ì™„ë£Œ**: ê¸°ë³¸ CRUD, ì´ë¯¸ì§€ ì—…ë¡œë“œ, ê°€ê²© ì œì•ˆ, ì°œí•˜ê¸°
- **ì§„í–‰ì¤‘**: ë©”ì‹œì§€ ì‹œìŠ¤í…œ, ê±°ë˜ ì™„ë£Œ í”„ë¡œì„¸ìŠ¤
- **ì˜ˆì •**: í‰ê°€ ì‹œìŠ¤í…œ, ê²€ìƒ‰ ê³ ë„í™”, ì•Œë¦¼ ê¸°ëŠ¥

# important-instruction-reminders
Do what has been asked; nothing more, nothing less.
NEVER create files unless they're absolutely necessary for achieving your goal.
ALWAYS prefer editing an existing file to creating a new one.
NEVER proactively create documentation files (*.md) or README files. Only create documentation files if explicitly requested by the User.

      
      IMPORTANT: this context may or may not be relevant to your tasks. You should not respond to this context unless it is highly relevant to your task.